<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fazla Mesai - Derimod</title>
    
    <!-- ANA EKRANA EKLEME VE İKON AYARLARI -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Mesai Takip">
    <meta name="theme-color" content="#1e293b">

    <!-- İKON TANIMLAMALARI (Altın Yaldızlı Derimod Konsepti) -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 fill=%22%231a1a1a%22 rx=%2220%22/><path d=%22M50 20 A 30 30 0 1 0 50 80 A 30 30 0 1 0 50 20 Z%22 fill=%22none%22 stroke=%22%23d4af37%22 stroke-width=%224%22/><path d=%22M50 35 L 50 50 L 60 55%22 fill=%22none%22 stroke=%22%23d4af37%22 stroke-width=%224%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22/></svg>">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 fill=%22%231a1a1a%22 rx=%2220%22/><path d=%22M50 20 A 30 30 0 1 0 50 80 A 30 30 0 1 0 50 20 Z%22 fill=%22none%22 stroke=%22%23d4af37%22 stroke-width=%224%22/><path d=%22M50 35 L 50 50 L 60 55%22 fill=%22none%22 stroke=%22%23d4af37%22 stroke-width=%224%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22/></svg>">

    <!-- Kütüphaneler (Babel güncellendi, çökme sorunu giderildi) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Daha stabil Phosphor İkon Kütüphanesi -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
</head>
<body class="bg-slate-50 antialiased selection:bg-yellow-600 selection:text-white">
    <div id="root"></div>

<script type="text/babel">
function App() {
  const currentMonthYear = new Date().toISOString().slice(0, 7);

  const [personnel, setPersonnel] = React.useState(() => {
    const saved = localStorage.getItem('fm_personnel');
    if (saved) return JSON.parse(saved).map(p => ({...p, isActive: p.isActive !== false}));
    return [];
  });

  const [records, setRecords] = React.useState(() => {
    const saved = localStorage.getItem('fm_records');
    return saved ? JSON.parse(saved) : [];
  });

  const [newPersonName, setNewPersonName] = React.useState('');
  
  const [newRecord, setNewRecord] = React.useState({
    personId: '', alacakSaat: '', ay: currentMonthYear, kullanilanSaat: '', tarih: ''
  });

  const [filterPersonId, setFilterPersonId] = React.useState('');
  
  const [modal, setModal] = React.useState({
    isOpen: false, title: '', message: '', onConfirm: null, type: 'danger'
  });

  const [errorMsg, setErrorMsg] = React.useState('');

  React.useEffect(() => { localStorage.setItem('fm_personnel', JSON.stringify(personnel)); }, [personnel]);
  React.useEffect(() => { localStorage.setItem('fm_records', JSON.stringify(records)); }, [records]);

  const formatMonthYear = (yyyy_mm) => {
    if (!yyyy_mm) return '-';
    const [year, month] = yyyy_mm.split('-');
    const aylar = ['Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran', 'Temmuz', 'Ağustos', 'Eylül', 'Ekim', 'Kasım', 'Aralık'];
    return `${aylar[parseInt(month, 10) - 1]} ${year}`;
  };

  const handleAddPerson = (e) => {
    e.preventDefault();
    if (!newPersonName.trim()) return;
    setPersonnel([...personnel, { id: Date.now(), name: newPersonName.trim(), isActive: true }]);
    setNewPersonName('');
  };

  const handleArchivePerson = (id) => {
    setModal({
      isOpen: true, title: 'İşten Çıkarma Onayı',
      message: 'Bu personeli işten çıkanlar listesine taşımak istediğinize emin misiniz? Tüm mesai verileri tabloda korunacaktır.',
      type: 'warning',
      onConfirm: () => { setPersonnel(personnel.map(p => p.id === id ? { ...p, isActive: false } : p)); setModal({ isOpen: false }); }
    });
  };

  const handleRestorePerson = (id) => { setPersonnel(personnel.map(p => p.id === id ? { ...p, isActive: true } : p)); };

  const handlePermanentDeletePerson = (id) => {
    setModal({
      isOpen: true, title: 'Kalıcı Silme Onayı',
      message: 'DİKKAT! Bu personeli ve ona ait TÜM mesai kayıtlarını KALICI OLARAK silmek istediğinize emin misiniz?',
      type: 'danger',
      onConfirm: () => {
        setPersonnel(personnel.filter(p => p.id !== id));
        setRecords(records.filter(r => r.personId.toString() !== id.toString()));
        if (filterPersonId === id.toString()) setFilterPersonId('');
        setModal({ isOpen: false });
      }
    });
  };

  const handleAddRecord = (e) => {
    e.preventDefault();
    setErrorMsg('');
    if (!newRecord.personId) { setErrorMsg('Lütfen kayıt eklemeden önce bir personel seçin!'); return; }
    
    setRecords([...records, {
      id: Date.now(), ...newRecord,
      alacakSaat: parseFloat(newRecord.alacakSaat) || 0,
      kullanilanSaat: parseFloat(newRecord.kullanilanSaat) || 0
    }]);
    setNewRecord({ ...newRecord, alacakSaat: '', kullanilanSaat: '', tarih: '' });
  };

  const handleDeleteRecord = (id) => {
    setModal({
      isOpen: true, title: 'Kaydı Silme Onayı', message: 'Bu mesai kaydını tablodan silmek istediğinize emin misiniz?', type: 'danger',
      onConfirm: () => { setRecords(records.filter(r => r.id !== id)); setModal({ isOpen: false }); }
    });
  };

  const getPerson = (personId) => personnel.find(p => p.id.toString() === personId.toString());

  const activePersonnel = personnel.filter(p => p.isActive);
  const inactivePersonnel = personnel.filter(p => !p.isActive);

  const filteredRecords = filterPersonId ? records.filter(r => r.personId.toString() === filterPersonId.toString()) : records;

  const totals = filteredRecords.reduce((acc, record) => {
    acc.alacak += parseFloat(record.alacakSaat) || 0; acc.kullanilan += parseFloat(record.kullanilanSaat) || 0; return acc;
  }, { alacak: 0, kullanilan: 0 });
  const totalKalan = totals.alacak - totals.kullanilan;

  // Güvenli başlık yazdırma işlemi
  const getToplamBaslik = () => {
    if (!filterPersonId) return "GENEL TOPLAM";
    const p = getPerson(filterPersonId);
    return p ? `${p.name} TOPLAM` : "TOPLAM";
  };

  return (
    <div className="min-h-screen bg-[#f8f9fa] p-4 md:p-8 font-sans text-slate-800">
      
      {/* Modal */}
      {modal.isOpen && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 backdrop-blur-sm">
          <div className="bg-white rounded-2xl shadow-xl max-w-md w-full p-6">
            <div className="flex items-center gap-3 mb-4">
              <div className={`p-3 rounded-full ${modal.type === 'danger' ? 'bg-red-100 text-red-600' : 'bg-yellow-100 text-yellow-700'}`}>
                <i className="ph ph-warning text-2xl"></i>
              </div>
              <h3 className="text-xl font-bold text-slate-900">{modal.title}</h3>
            </div>
            <p className="text-slate-600 mb-8 leading-relaxed">{modal.message}</p>
            <div className="flex justify-end gap-3">
              <button onClick={() => setModal({ ...modal, isOpen: false })} className="px-5 py-2.5 text-slate-700 hover:bg-slate-100 rounded-xl font-medium transition-colors">Vazgeç</button>
              <button onClick={modal.onConfirm} className={`px-5 py-2.5 text-white rounded-xl font-medium transition-colors shadow-sm ${modal.type === 'danger' ? 'bg-red-600 hover:bg-red-700' : 'bg-yellow-600 hover:bg-yellow-700'}`}>Evet, Onaylıyorum</button>
            </div>
          </div>
        </div>
      )}

      <div className="max-w-7xl mx-auto space-y-6">
        
        {/* Başlık - Derimod Siyah/Altın Konsepti */}
        <header className="bg-gradient-to-r from-slate-900 to-slate-800 p-6 rounded-2xl shadow-md border border-slate-700 flex items-center gap-5">
          <div className="bg-[#d4af37] p-3 rounded-xl text-slate-900 shadow-inner flex items-center justify-center">
            <i className="ph ph-clock text-3xl"></i>
          </div>
          <div>
            <h1 className="text-2xl font-bold text-white tracking-wide">MESAI TAKIP</h1>
            <p className="text-slate-300 text-sm mt-1 font-light">Derimod Personel Yönetim Sistemi</p>
          </div>
        </header>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          
          {/* Sol Kolon */}
          <div className="space-y-6">
            <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
              <h2 className="text-lg font-bold flex items-center gap-2 mb-4 border-b pb-3 text-slate-800 uppercase tracking-wider text-sm">
                <i className="ph ph-users text-lg text-[#d4af37]"></i> Aktif Personel
              </h2>
              
              <form onSubmit={handleAddPerson} className="flex flex-col gap-3 mb-6">
                <input type="text" placeholder="Yeni Personel Adı Soyadı" value={newPersonName} onChange={(e) => setNewPersonName(e.target.value)} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#d4af37] transition-all" />
                <button type="submit" disabled={!newPersonName.trim()} className="w-full bg-slate-900 hover:bg-black disabled:bg-slate-400 text-[#d4af37] px-4 py-3 rounded-xl transition-colors flex items-center justify-center gap-2 font-bold uppercase text-sm tracking-wider shadow-sm">
                  <i className="ph ph-user-plus text-lg"></i> Personel Ekle
                </button>
              </form>

              <div className="space-y-2 max-h-[250px] overflow-y-auto pr-2">
                {activePersonnel.length === 0 ? (
                  <p className="text-sm text-slate-500 text-center py-4 bg-slate-50 rounded-lg border border-dashed border-slate-300">Sistemde aktif personel bulunmuyor.</p>
                ) : (
                  activePersonnel.map(person => (
                    <div key={person.id} className="flex items-center justify-between bg-white px-4 py-3 rounded-xl border border-slate-100 shadow-sm">
                      <span className="font-semibold text-slate-700">{person.name}</span>
                      <button onClick={() => handleArchivePerson(person.id)} className="text-yellow-600 p-2 rounded-lg hover:bg-yellow-50 transition-colors bg-yellow-50/50" title="İşten Çıkar">
                        <i className="ph ph-user-minus text-lg"></i>
                      </button>
                    </div>
                  ))
                )}
              </div>
            </div>

            {inactivePersonnel.length > 0 && (
              <div className="bg-slate-100 p-6 rounded-2xl shadow-sm border border-slate-200">
                <h2 className="text-sm font-bold flex items-center gap-2 mb-4 border-b border-slate-200 pb-3 text-slate-600 uppercase tracking-wider">
                  <i className="ph ph-user-minus text-lg"></i> İşten Çıkanlar
                </h2>
                <div className="space-y-2 max-h-[200px] overflow-y-auto pr-2">
                  {inactivePersonnel.map(person => (
                    <div key={person.id} className="flex items-center justify-between bg-white px-4 py-3 rounded-xl border border-slate-200">
                      <span className="font-medium text-slate-400 text-sm line-through">{person.name}</span>
                      <div className="flex gap-2">
                        <button onClick={() => handleRestorePerson(person.id)} className="text-emerald-600 p-2 rounded-lg hover:bg-emerald-50 transition-colors bg-emerald-50/50" title="Geri Al">
                            <i className="ph ph-arrow-counter-clockwise text-base"></i>
                        </button>
                        <button onClick={() => handlePermanentDeletePerson(person.id)} className="text-red-600 p-2 rounded-lg hover:bg-red-50 transition-colors bg-red-50/50" title="Kalıcı Sil">
                            <i className="ph ph-trash text-base"></i>
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>

          {/* Orta/Sağ Kolon Form */}
          <div className="lg:col-span-2 space-y-6">
            <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
              <h2 className="text-lg font-bold flex items-center gap-2 mb-4 border-b pb-3 text-slate-800 uppercase tracking-wider text-sm">
                <i className="ph ph-plus text-lg text-[#d4af37]"></i> Yeni Mesai / Kullanım Ekle
              </h2>
              
              {errorMsg && <div className="mb-4 p-3 bg-red-50 border border-red-200 text-red-600 rounded-xl text-sm flex items-center gap-2"><i className="ph ph-warning text-base"></i>{errorMsg}</div>}

              <form onSubmit={handleAddRecord} className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
                <div className="space-y-1.5">
                  <label className="text-xs font-bold text-slate-500 uppercase tracking-wider">Personel *</label>
                  <select value={newRecord.personId} onChange={(e) => { setNewRecord({...newRecord, personId: e.target.value}); setErrorMsg(''); }} className={`w-full px-4 py-3 bg-slate-50 border rounded-xl focus:outline-none focus:ring-2 focus:ring-[#d4af37] ${errorMsg ? 'border-red-400' : 'border-slate-200'}`}>
                    <option value="">Seçiniz...</option>
                    {activePersonnel.map(p => <option key={p.id} value={p.id}>{p.name}</option>)}
                  </select>
                </div>

                <div className="space-y-1.5">
                  <label className="text-xs font-bold text-slate-500 uppercase tracking-wider">Alacak Saat</label>
                  <input type="number" step="0.5" min="0" placeholder="Örn: 10" value={newRecord.alacakSaat} onChange={(e) => setNewRecord({...newRecord, alacakSaat: e.target.value})} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#d4af37]" />
                </div>

                <div className="space-y-1.5">
                  <label className="text-xs font-bold text-slate-500 uppercase tracking-wider">Artı Ay / Yıl</label>
                  <input type="month" value={newRecord.ay} onChange={(e) => setNewRecord({...newRecord, ay: e.target.value})} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#d4af37]" />
                </div>

                <div className="space-y-1.5">
                  <label className="text-xs font-bold text-slate-500 uppercase tracking-wider">Kullanılan Saat</label>
                  <input type="number" step="0.5" min="0" placeholder="Örn: 4" value={newRecord.kullanilanSaat} onChange={(e) => setNewRecord({...newRecord, kullanilanSaat: e.target.value})} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#d4af37]" />
                </div>

                <div className="space-y-1.5">
                  <label className="text-xs font-bold text-slate-500 uppercase tracking-wider">Kullanım Tarihi</label>
                  <input type="date" value={newRecord.tarih} onChange={(e) => setNewRecord({...newRecord, tarih: e.target.value})} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#d4af37]" />
                </div>

                <div className="flex items-end">
                  <button type="submit" className="w-full bg-slate-900 hover:bg-black text-[#d4af37] px-4 py-3 rounded-xl transition-colors flex items-center justify-center gap-2 font-bold uppercase text-sm tracking-wider">
                    <i className="ph ph-floppy-disk text-lg"></i> Kaydet
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        {/* Tablo */}
        <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
          <div className="p-6 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center">
            <h2 className="text-lg font-bold flex items-center gap-2 text-slate-800 uppercase tracking-wider text-sm">
              <i className="ph ph-calendar text-lg text-[#d4af37]"></i> Detay Tablosu
            </h2>
            <div className="flex items-center gap-3">
              <span className="text-xs font-bold bg-slate-900 text-[#d4af37] px-3 py-1.5 rounded-full tracking-wider">
                Kayıt: {filteredRecords.length}
              </span>
            </div>
          </div>
          
          <div className="overflow-x-auto">
            <table className="w-full text-left border-collapse">
              <thead>
                <tr className="bg-slate-50 text-slate-500 text-xs uppercase tracking-wider border-b border-slate-200">
                  <th className="px-6 py-4 font-bold min-w-[200px]">
                    <div className="flex flex-col gap-2">
                      <span className="flex items-center gap-1"><i className="ph ph-funnel text-sm"></i> Personel İsmi</span>
                      <select value={filterPersonId} onChange={(e) => setFilterPersonId(e.target.value)} className="w-full px-2 py-2 bg-white border border-slate-300 rounded-lg text-slate-700 font-normal focus:outline-none focus:ring-1 focus:ring-slate-900">
                        <option value="">Tüm Personeller</option>
                        {activePersonnel.length > 0 && <optgroup label="Aktif Personel">{activePersonnel.map(p => <option key={p.id} value={p.id}>{p.name}</option>)}</optgroup>}
                        {inactivePersonnel.length > 0 && <optgroup label="İşten Çıkanlar">{inactivePersonnel.map(p => <option key={p.id} value={p.id}>{p.name}</option>)}</optgroup>}
                      </select>
                    </div>
                  </th>
                  <th className="px-6 py-4 font-bold text-center align-bottom pb-5">Alacak</th>
                  <th className="px-6 py-4 font-bold align-bottom pb-5">Ay / Yıl</th>
                  <th className="px-6 py-4 font-bold text-center text-orange-600 align-bottom pb-5">Kullanılan</th>
                  <th className="px-6 py-4 font-bold align-bottom pb-5">Tarih</th>
                  <th className="px-6 py-4 font-bold text-center text-green-600 align-bottom pb-5">Kalan</th>
                  <th className="px-6 py-4 font-bold text-right align-bottom pb-5">İşlem</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-slate-100">
                {filteredRecords.length === 0 ? (
                  <tr><td colSpan="7" className="px-6 py-12 text-center text-slate-400 font-medium">Kayıt bulunamadı.</td></tr>
                ) : (
                  filteredRecords.map((record) => {
                    const person = getPerson(record.personId);
                    const isPersonActive = person ? person.isActive : false;
                    const kalanSaat = record.alacakSaat - record.kullanilanSaat;

                    return (
                      <tr key={record.id} className={`transition-colors ${!isPersonActive ? 'bg-slate-50/50' : 'hover:bg-slate-50'}`}>
                        <td className="px-6 py-4 font-semibold text-slate-800">
                          {person ? person.name : 'Silinmiş'}
                          {!isPersonActive && <span className="ml-2 text-[9px] bg-slate-200 text-slate-600 px-2 py-0.5 rounded-full uppercase tracking-wider font-bold">Çıktı</span>}
                        </td>
                        <td className="px-6 py-4 text-center font-bold text-slate-700 bg-slate-50/50">{record.alacakSaat > 0 ? record.alacakSaat : '-'}</td>
                        <td className="px-6 py-4 text-slate-500 font-medium">{formatMonthYear(record.ay)}</td>
                        <td className="px-6 py-4 text-center font-bold text-orange-600 bg-orange-50/30">{record.kullanilanSaat > 0 ? record.kullanilanSaat : '-'}</td>
                        <td className="px-6 py-4 text-slate-500 text-sm">{record.tarih ? new Date(record.tarih).toLocaleDateString('tr-TR') : '-'}</td>
                        <td className={`px-6 py-4 text-center font-black text-lg ${kalanSaat > 0 ? 'text-green-600 bg-green-50/30' : kalanSaat < 0 ? 'text-red-600 bg-red-50/30' : 'text-slate-400'}`}>{kalanSaat}</td>
                        <td className="px-6 py-4 text-right">
                          <button onClick={() => handleDeleteRecord(record.id)} className="text-red-400 hover:text-red-600 p-2 rounded-lg hover:bg-red-50 transition-colors bg-white border border-slate-100 shadow-sm"><i className="ph ph-trash text-base"></i></button>
                        </td>
                      </tr>
                    );
                  })
                )}
              </tbody>
              {filteredRecords.length > 0 && (
                <tfoot className="bg-slate-900 border-t-4 border-[#d4af37]">
                  <tr>
                    <td className="px-6 py-5 font-bold text-white text-right uppercase text-xs tracking-wider">
                      {getToplamBaslik()}
                    </td>
                    <td className="px-6 py-5 font-black text-center text-white text-lg">{totals.alacak > 0 ? totals.alacak : '0'}</td>
                    <td className="px-6 py-5"></td>
                    <td className="px-6 py-5 font-black text-center text-orange-400 text-lg">{totals.kullanilan > 0 ? totals.kullanilan : '0'}</td>
                    <td className="px-6 py-5"></td>
                    <td className={`px-6 py-5 font-black text-center text-xl ${totalKalan > 0 ? 'text-green-400' : totalKalan < 0 ? 'text-red-400' : 'text-slate-400'}`}>{totalKalan}</td>
                    <td className="px-6 py-5"></td>
                  </tr>
                </tfoot>
              )}
            </table>
          </div>
        </div>

      </div>
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
</script>
</body>
</html>


